package types

import (
	"time"
)

// Vulnerabilities table stores unique vulnerability information
type Vulnerability struct {
	ID                     string     `gorm:"column:id;size:50;primaryKey"`
	PluginID               int        `gorm:"column:plugin_id;not null;uniqueIndex:plugin_unique"`
	PluginName             string     `gorm:"column:plugin_name;size:500;not null"`
	PluginFamily           string     `gorm:"column:plugin_family;size:100"`
	Severity               string     `gorm:"column:severity;type:enum('Info','Low','Medium','High','Critical');not null"`
	SeverityIndex          int        `gorm:"column:severity_index;default:0"`
	CVSSBaseScore          *float64   `gorm:"column:cvss_base_score;type:decimal(3,1)"`
	CVSSVector             string     `gorm:"column:cvss_vector;size:200"`
	CVSS3BaseScore         *float64   `gorm:"column:cvss3_base_score;type:decimal(3,1)"`
	CVSS3Vector            string     `gorm:"column:cvss3_vector;size:200"`
	VPRScore               *float64   `gorm:"column:vpr_score;type:decimal(4,1)"`
	CPE                    string     `gorm:"column:cpe;size:500"`
	Description            string     `gorm:"column:description;type:text"`
	Solution               string     `gorm:"column:solution;type:text"`
	Synopsis               string     `gorm:"column:synopsis;type:text"`
	SeeAlso                string     `gorm:"column:see_also;type:text"`
	PluginPublicationDate  *time.Time `gorm:"column:plugin_publication_date;type:datetime"`
	PluginModificationDate *time.Time `gorm:"column:plugin_modification_date;type:datetime"`
	PluginType             string     `gorm:"column:plugin_type;size:50"`
	CVE                    string     `gorm:"column:cve;type:text"`
	BID                    string     `gorm:"column:bid;type:text"`
	XRef                   string     `gorm:"column:xref;type:text"`
	RiskFactor             string     `gorm:"column:risk_factor;size:50"`
	CreatedAt              time.Time  `gorm:"column:created_at;autoCreateTime"`
	UpdatedAt              time.Time  `gorm:"column:updated_at;autoUpdateTime"`

	// Relationships
	AssetVulnerabilities []AssetVulnerability `gorm:"foreignKey:VulnerabilityID"`
}

// AssetVulnerabilities table represents the relationship between assets and vulnerabilities
type AssetVulnerability struct {
	ID                  string    `gorm:"column:id;size:50;primaryKey"`
	AssetID             string    `gorm:"column:asset_id;not null;index"`
	VulnerabilityID     string    `gorm:"column:vulnerability_id;not null;index"`
	PortID              *string   `gorm:"column:port_id;size:50"`
	Port                *int      `gorm:"column:port"`
	Protocol            string    `gorm:"column:protocol;size:10"`
	PluginOutput        string    `gorm:"column:plugin_output;type:text"`
	FirstDetected       time.Time `gorm:"column:first_detected;type:datetime;default:CURRENT_TIMESTAMP"`
	LastDetected        time.Time `gorm:"column:last_detected;type:datetime;default:CURRENT_TIMESTAMP"`
	Status              string    `gorm:"column:status;type:enum('Open','Closed','Risk Accepted','False Positive');default:'Open'"`
	ScanID              *int      `gorm:"column:scan_id"`
	HostIDNessus        *int      `gorm:"column:host_id_nessus"`
	VulnIndexNessus     *int      `gorm:"column:vuln_index_nessus"`
	SeverityIndexNessus *int      `gorm:"column:severity_index_nessus"`
	CountNessus         *int      `gorm:"column:count_nessus"`
	CreatedAt           time.Time `gorm:"column:created_at;autoCreateTime"`
	UpdatedAt           time.Time `gorm:"column:updated_at;autoUpdateTime"`

	// Relationships
	Asset         Assets        `gorm:"foreignKey:AssetID"`
	Vulnerability Vulnerability `gorm:"foreignKey:VulnerabilityID"`
	PortRef       *Port         `gorm:"foreignKey:PortID"`
}

// NessusScans table stores scan information from Nessus
type NessusScan struct {
	ID            int        `gorm:"column:id;primaryKey"`
	UUID          string     `gorm:"column:uuid;size:100;uniqueIndex"`
	Name          string     `gorm:"column:name;size:255;not null"`
	Status        string     `gorm:"column:status;size:50"`
	ScannerName   string     `gorm:"column:scanner_name;size:255"`
	Targets       string     `gorm:"column:targets;type:text"`
	ScanStartTime *time.Time `gorm:"column:scan_start_time;type:datetime"`
	ScanEndTime   *time.Time `gorm:"column:scan_end_time;type:datetime"`
	FolderID      *int       `gorm:"column:folder_id"`
	OwnerID       *int       `gorm:"column:owner_id"`
	PolicyName    string     `gorm:"column:policy_name;size:255"`
	CreatedAt     time.Time  `gorm:"column:created_at;autoCreateTime"`
	UpdatedAt     time.Time  `gorm:"column:updated_at;autoUpdateTime"`

	// Relationships
	AssetVulnerabilities []AssetVulnerability `gorm:"foreignKey:ScanID;references:ID"`
}
